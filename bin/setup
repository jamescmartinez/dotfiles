#!/usr/bin/env bash

# Install Homebrew
ruby -e "$(curl -fsSL \
  https://raw.githubusercontent.com/Homebrew/install/master/install)"

# Update Homebrew formulae
brew update

# Install binaries
binaries=(
  fish
  git
  hub
  heroku/brew/heroku
  postgres
  openssl
  fzf
  yarn --without-node
  vim
)
brew install "${binaries[@]}"

# Set shell to fish
sudo sh -c "echo $(which fish) >> /etc/shells"
chsh -s $(which fish)

# Install Fisher
curl https://git.io/fisher --create-dirs -sLo \
  ~/.config/fish/functions/fisher.fish

# Set fish prompt to Pure
fish -c "fisher add rafaelrinaldi/pure"

# Install fzf shell extensions
$(brew --prefix)/opt/fzf/install

# Install vim-plug
curl -fLo ~/.vim/autoload/plug.vim --create-dirs \
  https://raw.githubusercontent.com/junegunn/vim-plug/master/plug.vim

# Install dotfiles
script_dir=$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)
$script_dir/dotfiles

# Install asdf
git clone https://github.com/asdf-vm/asdf.git ~/.asdf

# Install languages
source ~/.asdf/asdf.sh
asdf_install_lang() {
  local language=$1
  asdf plugin-add $language
  local latest_version=$(asdf list-all $language | grep -x '[0-9.]*' | tail -1)

  if [ $language == "nodejs" ]
  then
    brew install gpg
    bash ~/.asdf/plugins/nodejs/bin/import-release-team-keyring
  fi

  asdf install $language $latest_version
  asdf global $language $latest_version
}

asdf_install_lang nodejs
asdf_install_lang python
asdf_install_lang ruby

# Clean Homebrew
brew cleanup

echo -n "You're all set!"
